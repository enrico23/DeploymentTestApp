trigger:
  batch: true
  branches:
    include:
    - main
pr:
    - main
pool:
  name: DemoPool
  vmImage: 'windows-2022'

variables:
  runEndToEnd: ${{ne(variables['Build.Reason'], 'PullRequest')}}
  pullRequestFileListPath: $(Agent.TempDirectory)\pullRequestFileList.json
# ---------------------------------

stages:
- stage: BuildStage
  displayName:  üèó Build Stage
  dependsOn: []

  jobs:
    - job: HelloWorld
      condition: eq(variables['Build.Reason'], 'PullRequest')
      displayName: Hello World
      steps:
        - task: PowerShell@2
          inputs:
            targetType: 'inline'
            script: |
              echo "Total changed $count files"
              echo "Commit hash $(Build.SourceVersion)"
              echo "PullRequest Target branch: $(System.PullRequest.TargetBranch)"
              $mergeBaseFetchHead = git merge-base FETCH_HEAD $(System.PullRequest.TargetBranch)
              echo "$(mergeBaseFetchHead)"
              $files=$(git --no-pager diff --name-only FETCH_HEAD $(git merge-base FETCH_HEAD $(System.PullRequest.TargetBranch)))
              $temp=$files -split ' '
              $count=$temp.Length
         