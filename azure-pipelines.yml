trigger:
  batch: true
  branches:
    include:
    - main

pool:
  name: DemoPool
  vmImage: 'windows-2022'

variables:
  runEndToEnd: ${{ne(variables['Build.Reason'], 'PullRequest')}}
  pullRequestFileListPath: $(Agent.TempDirectory)\pullRequestFileList.json
# ---------------------------------

stages:
- stage: BuildStage
  displayName:  üèó Build Stage
  dependsOn: []

  jobs:
  - job: HelloWorld
    displayName: Hello World
    steps:
      - task: PowerShell@2
        inputs:
          targetType: 'inline'
          script: |
            
            echo "Getting list of files changed."
            $targetBranch = $(System.PullRequest.TargetBranch)
            $targetBranchPath = $targetBranch -replace "refs/heads/", ""
            echo "Target branch path $targetBranchPath "
        
            $files = git --no-pager diff --name-only FETCH_HEAD $(git merge-base FETCH_HEAD $targetBranchPath)
           
            if($files)
            {
              foreach ($file in $files) {
                Write-Verbose "$file"
              }
            }
            else
            {
              Write-Warning "Found no files."
            }
      
            echo "Total changed $fileCount files"

