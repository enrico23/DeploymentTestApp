# When manually running the pipeline, you can select whether it
# succeeds or fails.
parameters:
- name: succeed
  displayName: Succeed or fail
  type: boolean
  default: false

trigger:
- main

pool:
  name: DemoPool
  vmImage: 'windows-2022'

variables:
  runEndToEnd: 'true'

# ---------------------------------

stages:
- stage: BuildStage
  displayName:  üèó Build Stage
  dependsOn: []

  jobs:
  - job: HelloWorld
    displayName: Hello World
    steps:
    - task: PowerShell@2
      displayName: Hello World
      inputs:
        targetType: inline
        script: Write-Host 'Hello
# ---------------------------------

- stage: IntegrationTestsStage
  displayName: üß™ Run integration tests
  dependsOn: [ 'BuildStage' ]
  condition: succeeded('BuildStage')

  jobs:
  - job: FeedbackIntegrationTests
    displayName: Feedback Integration Tests
    steps:
    - task: PowerShell@2
      displayName: Feedback
      inputs:
        targetType: inline
        script: Write-Host 'Hello, World from Integration Tests stage!'

# ---------------------------------

- stage: EndToEndTestsStage
  displayName: ü§ñ Run End to End tests
  dependsOn: [ 'BuildStage' ]
  condition: and(eq(variables.runEndToEnd, 'true'), succeeded('BuildStage'))
  
  jobs:
  - job: Feedback
    displayName: Feedback
    steps:
    - task: PowerShell@2
      displayName: Feedback
      inputs:
        targetType: inline
        script: Write-Host 'Hello, World from end 2 end stage!'